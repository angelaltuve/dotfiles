#!/bin/sh

cleanup() {
  rm -rf "$NCMPCPP_PREVIEW"
}
trap cleanup INT HUP EXIT

NCMPCPP_PREVIEW="$(mktemp -d -t ncmpcpp_preview-XXXXXX)"

music_dir="$HOME/Music"
previewdir="$NCMPCPP_PREVIEW"
filename="$(mpc --format "$music_dir"/%file% current)"

previewname="$previewdir/$(mpc --format %album% current | base64).png"

[ -e "$previewname" ] || ffmpeg -y -i "$filename" -an -vf scale=128:128 "$previewname" >/dev/null 2>&1

notify-send -r 27072 "Now Playing" "$(mpc --format '%title% \n%artist% - %album%' current)" -i "$previewname"
